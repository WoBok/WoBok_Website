<html>

<body>
    <button id="getFileList">获得文件列表</button>
    <div id="fileListContent"></div>
    <input type="text" id="fileName">
    <button id="getMarkdown">获得文档</button>
    <div id="markdownContent"></div>
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
    function BindClickEventById(id, event) {
        document.getElementById(id).addEventListener("click", event);
    }
    async function FetchText(url) {
        try {
            const response = await fetch(url);
            if (response.ok) {
                return response.text();
            } else {
                console.log(response.statusText);
                return null;
            }
        } catch (error) {
            console.log(error);
        }
    }
    async function FecthJson(url) {
        try {
            const response = await fetch(url);
            if (response.ok) {
                return response.json();
            } else {
                console.log(response.statusText);
                return null;
            }
        } catch (error) {
            console.log(error);
        }
    }
</script>

<script>
    async function GetMarkdownText(fileName) {
        var url = `/api/MarkdownLoader/${fileName}`;
        return await FetchText(url);
    }

    function ParseMarkdown(md) {
        document.getElementById("markdownContent").innerHTML = marked.parse(md);
    }

    function DisplayMarkdown(fileName) {
        GetMarkdownText(fileName).then(text => ParseMarkdown(text));
    }

    BindClickEventById("getMarkdown", () => {
        var fileName = document.getElementById("fileName").value;
        DisplayMarkdown(fileName);
    });

    function DisplayFileList(list) {
        var fileListContent = document.getElementById("fileListContent");
        fileListContent.innerText = "";
        var ulNode = document.createElement("ol");
        fileListContent.appendChild(ulNode);
        for (let l of list) {
            let liNode = document.createElement("li");
            let fileNameNode = document.createTextNode(l);
            liNode.appendChild(fileNameNode);
            liNode.addEventListener("click", () => {
                DisplayMarkdown(l);
            });
            ulNode.appendChild(liNode);
        }
    }

    BindClickEventById("getFileList", () => {
        FecthJson("api/FileList").then(json => DisplayFileList(json));
    });
</script>